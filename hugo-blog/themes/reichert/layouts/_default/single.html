{{ define "main" }}
{{ $posts := (where .Site.RegularPages "Section" "posts").ByDate.Reverse }}
{{ $recent := where $posts "Permalink" "ne" .Permalink | first 5 }}

<section class="blog-section">
    <div class="blog-layout">
        <div class="blog-main">
            <article class="blog-post">
                <header class="blog-post-header">
                    <div class="blog-post-meta">
                        <time class="blog-post-date" datetime="{{ .Date.Format "2006-01-02" }}">{{ .Date.Format "January 2, 2006" }}</time>
                        {{ with .Params.categories }}
                        <span class="post-category">{{ index . 0 }}</span>
                        {{ end }}
                    </div>
                    <h1 class="blog-post-title">{{ .Title }}</h1>
                    {{ with .Params.tags }}
                    <div class="blog-post-tags">
                        {{ range . }}
                        <a href="/blog/tags/{{ . | urlize }}/" class="post-tag">{{ . }}</a>
                        {{ end }}
                    </div>
                    {{ end }}
                </header>

                <div class="blog-post-content">
                    {{ .Content }}
                </div>

                <div class="blog-feedback">
                    <p class="blog-feedback-title">Have thoughts or questions?</p>
                    <p class="blog-feedback-text">I read everything. Send a note or suggest a topic.</p>
                    <div class="blog-feedback-actions">
                        <a href="/contact.html" class="blog-feedback-link">Contact</a>
                        <a href="mailto:thomas@reichert.law" class="blog-feedback-link">Email</a>
                    </div>
                </div>

                <footer class="blog-post-footer">
                    <a href="/blog/" class="blog-back-link">‚Üê Back to Blog</a>
                </footer>
            </article>
        </div>

        <aside class="blog-sidebar">
            <div class="sidebar-section sidebar-profile">
                <h3>About</h3>
                <div class="sidebar-profile-card">
                    <div class="sidebar-headshot-frame">
                        <img src="/images/headshot.jpg" alt="Thomas Reichert" class="sidebar-headshot">
                    </div>
                    <div class="sidebar-profile-text">
                        <p class="sidebar-profile-name">Thomas Reichert</p>
                        <p class="sidebar-profile-title">IP attorney and Assistant Professor of Law at SIU Simmons School of Law.</p>
                    </div>
                    <div class="sidebar-profile-links">
                        <a class="sidebar-profile-link" href="/academic.html">Academic</a>
                        <a class="sidebar-profile-link" href="https://ssrn.com/author=8082404" target="_blank" rel="noopener">SSRN</a>
                        <a class="sidebar-profile-link" href="https://www.linkedin.com/in/thomas-reichert-071376173/" target="_blank" rel="noopener">LinkedIn</a>
                    </div>
                </div>
            </div>

            <div class="sidebar-section">
                <h3>Subscribe</h3>
                <a href="/blog/index.xml" class="rss-subscribe">
                    <svg viewBox="0 0 24 24" fill="currentColor"><path d="M6.18 15.64a2.18 2.18 0 0 1 2.18 2.18C8.36 19 7.38 20 6.18 20C5 20 4 19 4 17.82a2.18 2.18 0 0 1 2.18-2.18M4 4.44A15.56 15.56 0 0 1 19.56 20h-2.83A12.73 12.73 0 0 0 4 7.27V4.44m0 5.66a9.9 9.9 0 0 1 9.9 9.9h-2.83A7.07 7.07 0 0 0 4 12.93V10.1Z"/></svg>
                    RSS Feed
                </a>
            </div>

            {{ if $recent }}
            <div class="sidebar-section">
                <h3>Recent Posts</h3>
                <ul class="sidebar-timeline">
                    {{ range $recent }}
                    <li>
                        <a href="{{ .Permalink }}">
                            <span class="timeline-date">{{ .Date.Format "Jan 2" }}</span>
                            <span class="timeline-title">{{ .Title | truncate 40 }}</span>
                        </a>
                    </li>
                    {{ end }}
                </ul>
            </div>
            {{ end }}

            {{ $categories := .Site.Taxonomies.categories }}
            {{ if $categories }}
            <div class="sidebar-section">
                <h3>Categories</h3>
                <ul class="sidebar-categories">
                    {{ range $name, $taxonomy := $categories }}
                    <li>
                        <a href="/blog/categories/{{ $name | urlize }}/">
                            {{ $name }}
                            <span class="count">{{ len $taxonomy }}</span>
                        </a>
                    </li>
                    {{ end }}
                </ul>
            </div>
            {{ end }}

            {{ $tags := .Site.Taxonomies.tags }}
            {{ if $tags }}
            <div class="sidebar-section">
                <h3>Tags</h3>
                <div class="sidebar-tags">
                    {{ range $name, $taxonomy := $tags }}
                    <a href="/blog/tags/{{ $name | urlize }}/" class="sidebar-tag">{{ $name }}</a>
                    {{ end }}
                </div>
            </div>
            {{ end }}

        </aside>
    </div>
</section>

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "{{ .Title }}",
  "datePublished": "{{ .Date.Format "2006-01-02T15:04:05Z07:00" }}",
  "dateModified": "{{ .Lastmod.Format "2006-01-02T15:04:05Z07:00" }}",
  "author": {
    "@type": "Person",
    "name": "Thomas Reichert",
    "url": "https://reichert.law"
  },
  "publisher": {
    "@type": "Person",
    "name": "Thomas Reichert"
  },
  "description": "{{ .Description | default .Summary | truncate 160 }}",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "{{ .Permalink }}"
  }
}
</script>
{{ end }}
